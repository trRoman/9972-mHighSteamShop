mhigh-steam.ru

// Пароль для админа
mhigh-steam.ru/login
E-mail: admin@ya.ru
Пароль: v9z-Yeb-hfi-6hg

Сайт меню бани
reg.ru
mhigh-steam.ru
ab.asatryan.015@mail.ru
v9z-Yeb-hfi-6hg
https://dnsadmin.hosting.reg.ru/manager/ispmgr

IP-адрес 193.227.240.138
Доступ к серверу
Логин: root
Пароль: Wc8Mak8wtZShOxqP

cd /root/9972-mhighsteamshop
git fetch origin --prune
git reset --hard origin/main
git clean -fd
yarn install
yarn build
sudo nginx -t
sudo systemctl restart nextjs-mhighsteam
sudo systemctl status nextjs-mhighsteam --no-pager -l
curl -I http://127.0.0.1:3010

git@github.com:trRoman/9972-mHighSteamShop.git

yarn install
yarn build
yarn start
yarn dev
yarn cache clean

git add .
git commit -m "обновил"
git push

git pull

<!-- Для загрузки продуктов в базу данных. Используются файлы из data/import, scripts/import_grill.js -->
yarn import:grill

<!-- # жёстко обновить код с origin/main -->
cd /root/9972-mhighsteamshop
git fetch origin --prune
git reset --hard origin/main
yarn build
sudo systemctl stop nginx
sudo systemctl start nginx
sudo systemctl reload nginx
sudo systemctl restart nextjs-mhighsteam
sudo systemctl stop nextjs-mhighsteam
sudo systemctl status nextjs-mhighsteam --no-pager -l

ls -lt /root/9972-mhighsteamshop/.next/standalone/public/products | head

// изменить сервис
sudo systemctl edit --full nextjs-mhighsteam.service

Периодически мониторить место: df -h и du -x -h --max-depth=1 /var /usr /root | sort -h.
Проверка и запуск вручную:
sudo /usr/local/sbin/cleanup_web.sh
df -h

ls -la
cp data/shop.db_backup9.db data/shop.db
cp data/shop.db data/shop_backup9-1-2.db
rm data/shop.db
cd /root/9972-mhighsteamshop/data/

curl -I http://mhigh-steam.ru

sudo nano /etc/nginx/sites-available/mhighsteam


  server {
         listen 80;
         server_name mhigh-steam.ru www.mhigh-steam.ru;
         return 301 https://$host$request_uri;
      }
    
      server {
        listen 443 ssl http2;
         server_name mhigh-steam.ru www.mhigh-steam.ru;
    
        ssl_certificate /etc/letsencrypt/live/mhigh-steam.ru-0001/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/mhigh-steam.ru-0001/privkey.pem;
        include /etc/letsencrypt/options-ssl-nginx.conf;
        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    
        client_max_body_size 50m;
    
        location ~ /\. { deny all; return 403; }
    
        # ВАЖНО: без alias — всё отдаёт Next.js, включая /products/*
        location / {
            proxy_pass http://127.0.0.1:3010;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_request_buffering off;
            proxy_connect_timeout 5s;
            proxy_read_timeout 60s;
            proxy_send_timeout 60s;
        }
    }